---
title: 发版记录
date: 2022-11-13 08:37:34
permalink: /smart-mqtt/release-notes.html
---
## [smart-mqtt broker v0.23发布（2023-06-24）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.23)
1. smart-http升级至1.2.5
2. layui-vue 升级至2.3.1
3. 企业版页面新增地图监控大屏。
## [smart-mqtt broker v0.22发布（2023-06-17）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.22)
【社区版】
1. 禁止客户端匹配 ”$“ 开头的主题名。
2. BrokerContext新增bundle、getBundle用于绑定自定义资源。
3. Broker服务的线程池、内存池支持资源复用。
4. 优化Broker端的消息推送模型。
5. 提升MqttClient通信服务稳定性。
6. smart-http升级至1.2.4

【企业版】
1. 移除redis-bridge-plugin模块，将于开源之夏活动中由社区同学贡献开源版。
2. 移除mqtt-bridge-plugin模块。
3. 优化指标统计
## [smart-mqtt broker v0.21发布（2023-06-03）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.21)
【社区版】
1. smart-socket 升级至1.5.29。
2. fastjson2 升级至 2.0.21.graal。
3. 迁移指标采集功能至企业版。
4. 优化SubAck的响应效率。
5. Broker支持注册 smart-socket 插件。
6. 新增事件类型：NOTIFY_TOPIC_PUSH，用于触发指定topic的消息推送。
7. 优化MQTT的连接会话管理。
8. 重构topic的订阅匹配模型。
9. 重构消息推送模型。
9. 重构飞行窗口。
10. 提升MqttClient服务稳定性。
11. 补充单元测试用例。

【企业版】
1. 采用异步方式持久化统计指标，降低对通信性能造成的影响。
2. 统计指标适配 Prometheus。

## [smart-mqtt broker v0.20发布（2023-05-20）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.20)
【社区版】
1. smart-socket 升级至1.5.27。
2. snakeyaml 升级至2.0。
3. 修复了消息编解码过程中的bug,提高消息传输的可靠性。
4. 优化了消息解码异常触发的状态机，降低误判概率。
5. 加强了消息编解码字节边界的检验，避免数据解析错误。
6. 改进了内存管理策略，减少通信过程中的内存消耗。
7. 修复了MQTT 5.0协议实现中的遗嘱消息和QoS2通信编解码问题。
8. 对遗嘱消息模型字段进行了优化，提高代码可读性。
9. 引入社区同学贡献的redis桥接模块，提供更多扩展选项。
10. 为MQTT Client提供更高效的pulbish能力，提升性能表现。

【企业版】
1. 补充表结构索引，解决慢sql问题。
2. 新增账户管理接口
3. Broker启动时重置旧连接状态。

## [smart-mqtt broker v0.19发布（2023-04-22）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.19)
1. 实现消息重发规范

## [smart-mqtt broker v0.18发布（2023-04-16）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.18)
1. 社区版中移除连接认证功能，后续将在企业版中重新提供一套相对成熟的方案。
2. 清理无用配置项。
3. 优化消息Push逻辑。
4. 重构 BrokerTopic 模型结构。
5. 社区版源码中补充关于商业授权的License注释。
6. 【企业版】优化Broker管理系统UI。
7. 【企业版】节点管理中补充 Broker 端口号的信息记录。
8. 【企业版】补充表索引，解决慢SQL问题。
9. 【企业版】H2数据库启用mysql模式。
10. 【企业版】关闭ChatGPT入口。（因为国内服务器已无法调用OpenAPI）

## [smart-mqtt broker v0.17发布（2023-03-19）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.17)
1. 通过引入smart-socket的插件化机制，以更低的性能损耗实现消息超时重发。
2. 修复此前版本引入的topic取消订阅不生效的bug。
3. 网络断开连接后即时中断消息推送，减少不必要的尝试。
4. MQTT Client 的topic订阅与取消订阅请求纳入飞行队列管理。
5. 重构部分消息模型。
6. 重构飞行队列，提供更加完善的Push能力。
7. 更合理的日志输出。

## [smart-mqtt broker v0.16发布（2023-03-19）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.16)
1. 优化 docker-compose.yml 配置，提升压测体验。
2. 简化客户端连接空闲超时处理逻辑，节省内存开销。
3. 显式管理 openAPI 服务的线程资源。
4. 提升IO的flush效率。
5. 调整内存消息队列的消费模式：当订阅者消费过慢导致消息被发布者覆盖，将直接跳跃至最新一条。
6. 简化消息的 Push 模型，并获得大幅的性能提升。
7. 暂时移除消息重发策略，会在后续版本中重构。
8. 缩小 MQTT Client 消息发送的锁粒度，提升通信效率。
9. 重构飞行队列，在高并发场景下能显著节省内存开销。
10. 其他关于内存和性能的细节优化。

## [smart-mqtt broker v0.15发布（2023-03-04）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.15)
**【社区版】**
1. smart-socket 版本调整至：1.5.24。
2. smart-http 版本升级值：1.1.21。
3. 完善 openAPI 定义，并提供部分接口实现。
4. 完善 MQTT5 协议规范的实现。
5. Broker 支持节点命名，用于集群模式下区分节点的唯一性。
6. 提供内存模式的指标统计功能。
7. 调整消息推送服务与插件模块的初始化顺序。
10. MQTT Client 支持飞行窗口，提供更稳定可靠的通信服务。
11. 消息序列化日志打印调整成 JSON 格式输出。
12. 改进后台管理系统的交互体验。

**【企业版】**
1. 新增 chatGPT 插件，实现与人工智能对话。
2. 新增 Database 插件，用于持久化Broker运行时数据以供后台管理系统展示。（适配数据库：H2、MySQL）
3. 实现现存所有的 openAPI 接口。


## [smart-mqtt broker v0.14发布（2023-01-28）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.14)
1. 新增事件类型：SUBSCRIBE_ACCEPT、UNSUBSCRIBE_ACCEPT、CONNACK
2. 重新设计MQTT协议编解码接口，提升代码可读性、扩展性、可维护性。
3. 新增broker后台管理系统。
4. 完善MQTT5.0规范实现：
   - smart-mqtt-client 模块适配 mqtt5.0 协议。
   - 客户端使用receiveMaximum限制客户端愿意同时处理的QoS等级1和QoS等级2的发布消息最大数量。
   - 如果服务端不愿意接受CONNECT但希望表明其MQTT服务端身份，可以发送包含原因码为0x84（不支持的协议版本）的CONNACK报文，然后必须关闭网络连接。
## [smart-mqtt broker v0.13发布（2022-12-31）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.13)
**社区版**
1. 适配 mqtt 5.0 规范协议。
2. 更新的项目readme描述信息。
3. MqttClient 支持 maxPacketSize 配置，限制 MQTT 消息包容量上限。
4. 增加事件类型：`SUBSCRIBE_REFRESH_TOPIC`，当客户端取消 topic 订阅时触发。
5. 修复特定场景下消息订阅失效问题。
6. 重新设计消息编解码器。使整体结构更清晰，更具扩展性。
7. smart-socket 升级至 `1.6.1`。

## [smart-mqtt broker v0.12发布（2022-12-31）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.12)
**社区版**
1. 优化客户端超时断连的提示信息。
2. 重构Connect消息的处理逻辑。
3. 实现连接认证失败的错误响应码。
4. topic订阅支持黑名单约束。
5. 优化Broker线程数配置，要求至少2个线程。
6. 整理provider包结构。
7. 修复操作系统 hosts 配置异常可能引发的接口阻塞问题。

**企业版**
1. 试用版License过期时间延续至2023年12月31日。
2. 修复 License 过期时间格式化错误问题。
3. 优化运行期间 License 过期后的提示文案。

## [smart-mqtt broker v0.11发布（2022-12-22）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.11)
**社区版**
1. MQTT默认的最大报文字节数调整为 1MB。
2. 调整Broker消息推送线程组名称。
3. 优化消息推送模型，获得更强劲的通信性能。
4. 调整MQTTClient线程组名称。
5. 提升飞行窗口稳定性

## [smart-mqtt broker v0.10发布（2022-12-16）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.10)
**社区版**
1. 采用自研的压测工具 smart-mqtt-bench 替换 emqx-bench，以获得更好更强劲的压测体验。
2. fastjson 升级至 fastjson2:2.0.20.graal。
3. 重构消息推送模型，通过优化设计获得更高的通信性能。
4. 新增事件总线的事件类型：MESSAGE_BUS_CONSUMED
5. MemoryMessageStoreQueue 仅存储类型为 MqttPublishMessage 的消息。
6. 缓冲区配置参数由 readBufferSize 调整为 bufferSize，且 read/write 共享该参数。
7. 新增 Broker 服务的 Topic 数量限制，且默认值为：1024。
8. MQTT Broker 支持的最大报文采用参数化配置：maxPacketSize。
9. maxKeepAliveTime 由 1分钟调整成10分钟。
10. 移除 BrokerContext#batchPublish 接口。
11. 移除 MonitorPlugin 插件。
12. 多个 MQTTClient 支持共享内存池。
13. MQTT Client 缓冲区采用参数配置化。
14. 支持临时扩容缓冲区容量，不超过 maxPacketSize 即可。
15. 升级飞行窗口流控算法。
16. 消息输出支持主动和被动两种模式。

**企业版**

1. 调整授权提示信息。
2. 改进打包工具。
3. 适配最新版 smart-mqtt。

## [smart-mqtt broker v0.9发布（2022-12-03）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.9)
**社区版**
1. 读缓冲区大小调整为参数配置化。
2. CONNECT_TIMEOUT默认值调整为5秒
3. MQTT 消息输出功能调整为MqttWriter接口的具体实现类，以适应 mqtt-over-websocket 的场景。
4. 修复unsubscribe一个未订阅的 topic 时引发的空指针问题。
5. 配置文件调整为 yaml 格式。
6. 插件服务支持优先级排序。

**企业版**
1. 新增消息桥接插件，现已实现了 mqtt-bridge-mqtt。
2. 新增 mqtt-over-websocket新特性。

## [smart-mqtt broker v0.8发布（2022-11-12）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.8)
1. 升级 smart-socket 至 1.5.23
2. smart-mqtt 相关组件提交至 Maven 中央仓库。【ISSUE：[I5ZOQ4](https://gitee.com/smartboot/smart-mqtt/issues/I5ZOQ4)】
3. 重构消息总线
4. 指标监控频率调整为1分钟。
5. 客户端支持通配符订阅。【ISSUE：[I5ZJLZ](https://gitee.com/smartboot/smart-mqtt/issues/I5ZJLZ)】
6. 修复客户端重连后没有触发 Topic 订阅的问题。

## [smart-mqtt broker v0.7发布（2022-09-10）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.7)
1. 新增 docker-compose.yml ，极致体验的 MQTT Broker。
2. 优化日志级别。
3. Broker接受消息后不对Qos进行持久化。
4. ping响应消息采用单例模式。
5. 支持系统环境变量配置broker运行参数，现开放 BROKER_PORT、BROKER_THREADNUM两项配置。
6. 将插件的启动先于 Broker TCP服务启动之前完成。
7. 启动 TCP 服务时若发生异常释放相关资源。
8. 启用内存池，提升运行性能。
9. 消息read缓冲区暂时下降至 4KB，下个迭代换成配置化。
10. 启用运行指标监控插件。
## [smart-mqtt broker v0.6发布（2022-09-03）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.6)
1. 应社区用户要求，开源版 smart-mqtt适配 JDK 回退至1.8。
2. 完善retain消息的规范实现，当服务端接收到保留标志为 1 且有效载荷为零字节的 PUBLISH 报文时，该主题下任何现存的保留消息必须被移除。
3. 优化日志输出格式，增加时间信息。
4. smart-mqtt broker 线程数支持配置化。
5. 更新客户端connect鉴权的接口设计。(by @yamikaze )
6. 支持docker启动 smart-mqtt 服务
7. 修复mqtt协议版本不兼容时引发的空指针问题。
8. 修复订阅topic后retain消息被无限推送的问题。

## [smart-mqtt broker v0.5发布（2022-07-17）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.5)
1. 【新特性】Broker支持客户端连接鉴权
2. 【优化】重构Topic订阅逻辑，并增加重订阅特性
3. 【优化】简化客户端连接超时监听的处理逻辑。
4. 【优化】对各事件类型打上标注
5. 【优化】清理TopicFilterProvider，开源版与企业版保持同等Topic匹配策略
6. 【优化】采用事件总线监听连接活跃状态
7. 【优化】确保网络断开后，事件状态 EventType.DISCONNECT 必然被调用
8. 【优化】引入订阅事件的退出机制
9. 【优化】AbstractSession 新增 getRemoteAddress 接口

## [smart-mqtt broker v0.4发布（2022-07-10）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.4)
1. 【新特性】升级了Broker内核的架构设计，采用事件驱动+消息驱动的双引擎模式构建出具备高度扩展性的MQTT服务
2. 【新特性】支持Topic通配符的订阅方式
3. 【优化】彻底移除了原先监听器的功能，统一切换至事件总线
4. 【优化】引入 slf4j-simple 进行日志输出
5. 【优化】升级 smart-socket 至 1.5.19，带来更安全的网络通讯，可支持 TLSv1.3
6. 【优化】移除 fastjson 依赖
7. 【优化】其他一些细节优化
8. 【Bugfix】修复连接成功后userName未绑定至MqttSession的问题

## [smart-mqtt broker v0.3发布（2022-05-01）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.3)
1. 【新特性】Retain 消息内存持久化，并在客户端 CONNECT 成功后推送匹配的消息。
2. 【新特性】新增飞行窗口（Inflight Window）功能，限制同时发送Qos1和Qos2的数量，保障通信质量。
3. 【新特性】新增 MQTT Broker 和 MQTT Client 的消息重发功能。
4. 【优化】重构 MQTT 消息模型设计。
5. 【优化】改进消息内存持久化的处理逻辑。
6. 【优化】提升并发场景下的线程安全性。
7. 【优化】改进客户端的 subscribe 和 publish 的接口设计。
8. 【优化】客户端正常断开连接时发送 DISCONNECT 消息。
9. 【优化】MQTT 消息对象序列化调整为 JSON 格式。
10. 【优化】主动拦截已断开连接的消息发送行为。
11. 【优化】以正整数作为合法的 packetId。
12. 【优化】补充压测的单元测试。
13. 【bugfix】修复Broker端在某些异常场景下资源释放不彻底问题。
14. 【bugfix】修复 CONNECT 消息的合法性校验错误问题：如果客户端提供的 ClientId 为零字节且清理会话标志为 0，服务端必须发送返回码为 0x02的 CONNACK 报文响应客户端的 CONNECT 报文。

## [smart-mqtt broker v0.2发布（2022-04-18）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.2)
1. 优化客户端ping消息：发送了 PINGREQ 报文之后，如果在合理的时间内仍没有收到 PINGRESP 报文，则关闭到服务端的网络连接。
2. 优化Connect消息监听：网络连接建立后，如果服务端在合理的时间内没有收到 CONNECT 报文，服务端应该关闭这个连接。
3. 优化 Connect ACK 消息监听：如果客户端在合理的时间内没有收到服务端的 CONNACK 报文，客户端应该关闭网络连接。
4. 优化报文标识符的生成策略，防止同一标识符在同时刻被复用。
5. 内存持久化会话状态。
6. 重构Qos1和Qos2的回调处理机制。
7. bugfix:修复unsuback报文标识符取值不正确问题
8. bugfix:修复 broker 推送消息至subscriber时继承了publisher消息质量的问题。
9. 其他一些代码细节优化

## [smart-mqtt broker v0.1发布（2022-04-14）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.1)
1. 支持MQTT v3.1.1协议标准
2. 支持Qos0、Qos1、Qos2 的消息传递
3. 支持遗嘱消息
4. 支持 retain 消息
5. 支持心跳消息
6. 插件化设计模式
7. mqtt client 相关功能
8. 优雅停机