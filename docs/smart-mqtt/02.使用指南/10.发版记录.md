---
title: 发版记录
date: 2022-11-13 08:37:34
permalink: /smart-mqtt/release-notes.html
---

## [smart-mqtt broker v0.10发布（2022-12-16）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.10)
**社区版**
1. 采用自研的压测工具 smart-mqtt-bench 替换 emqx-bench，以获得更好更强劲的压测体验。
2. fastjson 升级至 fastjson2:2.0.20.graal。
3. 重构消息推送模型，通过优化设计获得更高的通信性能。
4. 新增事件总线的事件类型：MESSAGE_BUS_CONSUMED
5. MemoryMessageStoreQueue 仅存储类型为 MqttPublishMessage 的消息。
6. 缓冲区配置参数由 readBufferSize 调整为 bufferSize，且 read/write 共享该参数。
7. 新增 Broker 服务的 Topic 数量限制，且默认值为：1024。
8. MQTT Broker 支持的最大报文采用参数化配置：maxPacketSize。
9. maxKeepAliveTime 由 1分钟调整成10分钟。
10. 移除 BrokerContext#batchPublish 接口。
11. 移除 MonitorPlugin 插件。
12. 多个 MQTTClient 支持共享内存池。
13. MQTT Client 缓冲区采用参数配置化。
14. 支持临时扩容缓冲区容量，不超过 maxPacketSize 即可。
15. 升级飞行窗口流控算法。
16. 消息输出支持主动和被动两种模式。

**企业版**

1. 调整授权提示信息。
2. 改进打包工具。
3. 适配最新版 smart-mqtt。

## [smart-mqtt broker v0.9发布（2022-12-03）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.9)
**社区版**
1. 读缓冲区大小调整为参数配置化。
2. CONNECT_TIMEOUT默认值调整为5秒
3. MQTT 消息输出功能调整为MqttWriter接口的具体实现类，以适应 mqtt-over-websocket 的场景。
4. 修复unsubscribe一个未订阅的 topic 时引发的空指针问题。
5. 配置文件调整为 yaml 格式。
6. 插件服务支持优先级排序。

**企业版**
1. 新增消息桥接插件，现已实现了 mqtt-bridge-mqtt。
2. 新增 mqtt-over-websocket新特性。

## [smart-mqtt broker v0.8发布（2022-11-12）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.8)
1. 升级 smart-socket 至 1.5.23
2. smart-mqtt 相关组件提交至 Maven 中央仓库。【ISSUE：[I5ZOQ4](https://gitee.com/smartboot/smart-mqtt/issues/I5ZOQ4)】
3. 重构消息总线
4. 指标监控频率调整为1分钟。
5. 客户端支持通配符订阅。【ISSUE：[I5ZJLZ](https://gitee.com/smartboot/smart-mqtt/issues/I5ZJLZ)】
6. 修复客户端重连后没有触发 Topic 订阅的问题。

## [smart-mqtt broker v0.7发布（2022-09-10）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.7)
1. 新增 docker-compose.yml ，极致体验的 MQTT Broker。
2. 优化日志级别。
3. Broker接受消息后不对Qos进行持久化。
4. ping响应消息采用单例模式。
5. 支持系统环境变量配置broker运行参数，现开放 BROKER_PORT、BROKER_THREADNUM两项配置。
6. 将插件的启动先于 Broker TCP服务启动之前完成。
7. 启动 TCP 服务时若发生异常释放相关资源。
8. 启用内存池，提升运行性能。
9. 消息read缓冲区暂时下降至 4KB，下个迭代换成配置化。
10. 启用运行指标监控插件。
## [smart-mqtt broker v0.6发布（2022-09-03）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.6)
1. 应社区用户要求，开源版 smart-mqtt适配 JDK 回退至1.8。
2. 完善retain消息的规范实现，当服务端接收到保留标志为 1 且有效载荷为零字节的 PUBLISH 报文时，该主题下任何现存的保留消息必须被移除。
3. 优化日志输出格式，增加时间信息。
4. smart-mqtt broker 线程数支持配置化。
5. 更新客户端connect鉴权的接口设计。(by @yamikaze )
6. 支持docker启动 smart-mqtt 服务
7. 修复mqtt协议版本不兼容时引发的空指针问题。
8. 修复订阅topic后retain消息被无限推送的问题。

## [smart-mqtt broker v0.5发布（2022-07-17）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.5)
1. 【新特性】Broker支持客户端连接鉴权
2. 【优化】重构Topic订阅逻辑，并增加重订阅特性
3. 【优化】简化客户端连接超时监听的处理逻辑。
4. 【优化】对各事件类型打上标注
5. 【优化】清理TopicFilterProvider，开源版与企业版保持同等Topic匹配策略
6. 【优化】采用事件总线监听连接活跃状态
7. 【优化】确保网络断开后，事件状态 EventType.DISCONNECT 必然被调用
8. 【优化】引入订阅事件的退出机制
9. 【优化】AbstractSession 新增 getRemoteAddress 接口

## [smart-mqtt broker v0.4发布（2022-07-10）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.4)
1. 【新特性】升级了Broker内核的架构设计，采用事件驱动+消息驱动的双引擎模式构建出具备高度扩展性的MQTT服务
2. 【新特性】支持Topic通配符的订阅方式
3. 【优化】彻底移除了原先监听器的功能，统一切换至事件总线
4. 【优化】引入 slf4j-simple 进行日志输出
5. 【优化】升级 smart-socket 至 1.5.19，带来更安全的网络通讯，可支持 TLSv1.3
6. 【优化】移除 fastjson 依赖
7. 【优化】其他一些细节优化
8. 【Bugfix】修复连接成功后userName未绑定至MqttSession的问题

## [smart-mqtt broker v0.3发布（2022-05-01）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.3)
1. 【新特性】Retain 消息内存持久化，并在客户端 CONNECT 成功后推送匹配的消息。
2. 【新特性】新增飞行窗口（Inflight Window）功能，限制同时发送Qos1和Qos2的数量，保障通信质量。
3. 【新特性】新增 MQTT Broker 和 MQTT Client 的消息重发功能。
4. 【优化】重构 MQTT 消息模型设计。
5. 【优化】改进消息内存持久化的处理逻辑。
6. 【优化】提升并发场景下的线程安全性。
7. 【优化】改进客户端的 subscribe 和 publish 的接口设计。
8. 【优化】客户端正常断开连接时发送 DISCONNECT 消息。
9. 【优化】MQTT 消息对象序列化调整为 JSON 格式。
10. 【优化】主动拦截已断开连接的消息发送行为。
11. 【优化】以正整数作为合法的 packetId。
12. 【优化】补充压测的单元测试。
13. 【bugfix】修复Broker端在某些异常场景下资源释放不彻底问题。
14. 【bugfix】修复 CONNECT 消息的合法性校验错误问题：如果客户端提供的 ClientId 为零字节且清理会话标志为 0，服务端必须发送返回码为 0x02的 CONNACK 报文响应客户端的 CONNECT 报文。

## [smart-mqtt broker v0.2发布（2022-04-18）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.2)
1. 优化客户端ping消息：发送了 PINGREQ 报文之后，如果在合理的时间内仍没有收到 PINGRESP 报文，则关闭到服务端的网络连接。
2. 优化Connect消息监听：网络连接建立后，如果服务端在合理的时间内没有收到 CONNECT 报文，服务端应该关闭这个连接。
3. 优化 Connect ACK 消息监听：如果客户端在合理的时间内没有收到服务端的 CONNACK 报文，客户端应该关闭网络连接。
4. 优化报文标识符的生成策略，防止同一标识符在同时刻被复用。
5. 内存持久化会话状态。
6. 重构Qos1和Qos2的回调处理机制。
7. bugfix:修复unsuback报文标识符取值不正确问题
8. bugfix:修复 broker 推送消息至subscriber时继承了publisher消息质量的问题。
9. 其他一些代码细节优化

## [smart-mqtt broker v0.1发布（2022-04-14）](https://gitee.com/smartboot/smart-mqtt/releases/tag/v0.1)
1. 支持MQTT v3.1.1协议标准
2. 支持Qos0、Qos1、Qos2 的消息传递
3. 支持遗嘱消息
4. 支持 retain 消息
5. 支持心跳消息
6. 插件化设计模式
7. mqtt client 相关功能
8. 优雅停机